<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The Forge Recipe Database Viewer - Browse and search all crafting recipes for The Forge Roblox game">
    <link rel="canonical" href="https://forge-calculator.com/recipes/recipe-viewer.html">
    <title>The Forge Recipe Database Viewer</title>
    
    <!-- Advertisement code removed for security compliance -->    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff5722;
            --primary-dark: #e64a19;
            --primary-light: rgba(255, 87, 34, 0.2);
            --stonewake-teal: #00bcd4;
            --card-bg: #1e1e1e;
            --border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --border-radius: 12px;
            --glow: 0 0 20px rgba(255, 87, 34, 0.5);
            --success: #4caf50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text);
            padding: 2rem;
            line-height: 1.6;
        }
        
        .recipe-database-container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
        }
        
        .database-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .database-header h2 {
            color: var(--primary);
        }
        
        .search-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .search-input, .filter-select {
            padding: 10px 15px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            min-width: 200px;
        }
        
        .database-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--primary-light), rgba(0,0,0,0.2));
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--primary-light);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .category-tab {
            padding: 10px 20px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            border-radius: 25px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-color: var(--primary);
        }
        
        .category-tab:hover:not(.active) {
            background: var(--primary-light);
            border-color: var(--primary);
        }
        
        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .recipe-card {
            background: linear-gradient(145deg, #1e1e1e 0%, #2a2a2a 100%);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--glow);
        }
        
        .recipe-card.weapon {
            border-color: var(--primary);
        }
        
        .recipe-card.armor {
            border-color: var(--stonewake-teal);
        }
        
        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .recipe-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text);
        }
        
        .recipe-type {
            padding: 5px 10px;
            background: var(--primary-light);
            border-radius: 15px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .recipe-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .recipe-stat {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .recipe-stat i {
            color: var(--primary);
        }
        
        .recipe-ores {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .ore-tag {
            padding: 5px 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            font-size: 0.8rem;
            border: 1px solid #ff9800;
        }
        
        .recipe-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .recipe-success {
            font-weight: bold;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="recipe-database-container">
        <div class="database-header">
            <h2><i class="fas fa-book"></i> 锻造配方数据库</h2>
            <div class="search-controls">
                <input type="text" id="recipe-search" placeholder="搜索武器/护甲..." class="search-input">
                <select id="recipe-filter" class="filter-select">
                    <option value="all">所有类型</option>
                    <option value="weapon">武器</option>
                    <option value="armor">护甲</option>
                </select>
            </div>
        </div>
        
        <div class="database-stats">
            <div class="stat-card">
                <div class="stat-label">武器配方</div>
                <div class="stat-value" id="weapon-count">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">护甲配方</div>
                <div class="stat-value" id="armor-count">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">总配方数</div>
                <div class="stat-value" id="total-recipes">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">平均成功率</div>
                <div class="stat-value" id="avg-success">0%</div>
            </div>
        </div>
        
        <div class="recipe-categories">
            <div class="category-tabs">
                <button class="category-tab active" data-category="weapon">武器</button>
                <button class="category-tab" data-category="armor">护甲</button>
            </div>
        </div>
        
        <div class="recipe-grid" id="recipe-grid">
            <!-- 配方卡片将在这里动态加载 -->
        </div>
    </div>

    <script>
        class RecipeDatabaseUI {
            constructor() {
                this.recipeData = null;
                this.currentCategory = 'weapon';
                this.currentSearch = '';
                this.loadDatabase();
            }
            
            async loadDatabase() {
                try {
                    // 尝试加载 recipe database 文件（URL编码空格）
                    const response = await fetch('recipe%20database');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    this.recipeData = await response.json();
                    console.log('成功加载配方数据:', this.recipeData);
                    this.init();
                } catch (error) {
                    console.error('加载配方数据库失败:', error);
                    document.getElementById('recipe-grid').innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #f44336;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <p>无法加载配方数据库</p>
                            <p style="font-size: 0.9rem; margin-top: 10px;">错误: ${error.message}</p>
                            <p style="font-size: 0.8rem; margin-top: 5px; color: var(--text-secondary);">
                                请确保在HTTP服务器环境下运行此文件
                            </p>
                        </div>
                    `;
                }
            }
            
            init() {
                this.renderStats();
                this.renderRecipes();
                this.setupEventListeners();
            }
            
            renderStats() {
                if (!this.recipeData) return;
                
                const weaponCount = Object.keys(this.recipeData.weapons).length;
                const armorCount = Object.keys(this.recipeData.armors).length;
                
                document.getElementById('weapon-count').textContent = weaponCount;
                document.getElementById('armor-count').textContent = armorCount;
                document.getElementById('total-recipes').textContent = this.recipeData.metadata.total_recipes;
                
                const allItems = [...Object.values(this.recipeData.weapons), ...Object.values(this.recipeData.armors)];
                const avgSuccess = allItems.length > 0 
                    ? Math.round(allItems.reduce((sum, item) => sum + item.probability, 0) / allItems.length)
                    : 0;
                
                document.getElementById('avg-success').textContent = `${avgSuccess}%`;
            }
            
            renderRecipes() {
                if (!this.recipeData) return;
                
                const grid = document.getElementById('recipe-grid');
                grid.innerHTML = '';
                
                let itemsToDisplay = [];
                
                if (this.currentCategory === 'weapon') {
                    itemsToDisplay = Object.entries(this.recipeData.weapons).map(([name, data]) => ({
                        type: 'weapon',
                        name,
                        ...data
                    }));
                } else if (this.currentCategory === 'armor') {
                    itemsToDisplay = Object.entries(this.recipeData.armors).map(([name, data]) => ({
                        type: 'armor',
                        name,
                        ...data
                    }));
                }
                
                if (this.currentSearch) {
                    itemsToDisplay = itemsToDisplay.filter(item =>
                        item.name.toLowerCase().includes(this.currentSearch.toLowerCase())
                    );
                }
                
                itemsToDisplay.forEach(item => {
                    const recipe = item.recipes.balanced || item.recipes.budget || item.recipes.premium;
                    
                    const card = document.createElement('div');
                    card.className = `recipe-card ${item.type}`;
                    
                    card.innerHTML = `
                        <div class="recipe-header">
                            <div class="recipe-title">${item.name}</div>
                            <div class="recipe-type">${item.type === 'weapon' ? '武器' : '护甲'}</div>
                        </div>
                        
                        <div class="recipe-stats">
                            <div class="recipe-stat">
                                <i class="fas fa-hashtag"></i>
                                <span>${recipe.total_ores} 矿石</span>
                            </div>
                            <div class="recipe-stat">
                                <i class="fas fa-percentage"></i>
                                <span>${recipe.success_rate.toFixed(1)}% 成功率</span>
                            </div>
                            <div class="recipe-stat">
                                <i class="fas fa-times"></i>
                                <span>${recipe.avg_multiplier}x 乘数</span>
                            </div>
                        </div>
                        
                        <div class="recipe-ores">
                            ${recipe.ores.slice(0, 3).map(ore => `
                                <div class="ore-tag">
                                    ${ore.name} ×${ore.count}
                                </div>
                            `).join('')}
                            ${recipe.ores.length > 3 ? `<div class="ore-tag">+${recipe.ores.length - 3}种</div>` : ''}
                        </div>
                        
                        <div class="recipe-meta">
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">
                                ${recipe.name}
                            </div>
                            <div class="recipe-success">
                                ${item.probability.toFixed(1)}%
                            </div>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
                
                if (itemsToDisplay.length === 0) {
                    grid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                            <i class="fas fa-search" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 15px;"></i>
                            <p style="color: var(--text-secondary);">没有找到匹配的配方</p>
                        </div>
                    `;
                }
            }
            
            setupEventListeners() {
                document.querySelectorAll('.category-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentCategory = e.target.dataset.category;
                        this.renderRecipes();
                    });
                });
                
                document.getElementById('recipe-search').addEventListener('input', (e) => {
                    this.currentSearch = e.target.value;
                    this.renderRecipes();
                });
                
                document.getElementById('recipe-filter').addEventListener('change', (e) => {
                    this.currentCategory = e.target.value === 'all' ? 'weapon' : e.target.value;
                    this.renderRecipes();
                });
            }
        }
        
        // 初始化
        const recipeDBUI = new RecipeDatabaseUI();
    </script>
</body>
</html>
